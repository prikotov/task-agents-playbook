# Рекомендации по улучшению системы задач для работы с ИИ-агентами
# Файл: IMPROVEMENTS.md
# Дата: 31 декабря 2025
# Версия: 1.0
# source: https://x.com/i/grok?conversation=2006358340377411985

# Цель
Повысить качество и эффективность взаимодействия с ИИ-агентами (Cursor, Claude Code, Aider и др.)  
с текущих ~8.7–9.2 до 9.5+ по меркам конца 2025 года.

## Приоритетный план внедрения (ближайшие 1–2 недели)

### 1. Создать глобальный файл AGENTS.md (или CLAUDE.md / .cursor/rules/main.mdc)
Расположение: корень репозитория

Содержимое (минимальный рекомендуемый набор):

```markdown
# AGENTS.md — Глобальные правила и инструкции для ИИ-агентов

## Основные принципы
- Всегда сначала полностью прочитай файл задачи (*.todo.md)
- Держи изменения атомарными: один осмысленный commit ≈ одна логическая цель
- Максимальный размер diff: 400 строк (added + deleted). Если больше — предложи декомпозицию
- Предпочитай TDD-подход: тесты → реализация → рефакторинг
- Используй feature flags для новых фич
- Всегда добавляй/обновляй документацию в коде (PHPDoc / JSDoc / Rustdoc и т.д.)
- После каждого крупного шага обновляй раздел "План реализации" в файле задачи (добавляй ✅ и новые шаги)

## При работе с задачами из todo
1. Читай весь .todo.md
2. Если scope неясен — задавай уточняющие вопросы
3. После анализа обнови раздел "Затрагиваемые файлы", если нужно
4. После завершения каждого этапа: обновляй "План реализации"
5. Перед финальным PR: проверь все критерии выполнения
6. После выполнения задачи всегда спроси:
   "Что полезного можно добавить в AGENTS.md на основе этой задачи?"

## Стиль кода (адаптировать под проект)
- Именование: camelCase / snake_case / PascalCase — следовать существующему стилю
- Максимальная длина функции/метода: 40–50 строк
- Предпочитай композицию над наследованием
- Избегай side-effects в чистых функциях
```

### 2. Обновить шаблон задачиДобавить в раздел ## Метаданные каждой задачи:

Добавить в раздел ## Метаданные каждой задачи:

```markdown
- **Assignee**: @human / @claude / @cursor / @aider / @reviewer
- **Attempts**: 1/3          # количество попыток агента
- **Last error**: (описание последней ошибки, если была)
```

Добавить в AGENTS.md инструкцию:  
«Если assignee = @claude (или другой агент) → действуй самостоятельно без лишних вопросов»

### 3. Настроить центральный `todo/` с чекбоксами

Создай файлы задач в `todo/`

Минимальный пример:

```markdown
# Активные задачи

## P0 — Критические
- [ ] TASK-...

## P1 — Высокий приоритет
- [ ] TASK-...

## P2 — Средний
- [ ] ...

## Backlog → перенести в работу
→ см. todo/backlog/
```

Для автоматизации можно позже добавить скрипт `update-todo.py`.

В AGENTS.md добавить правило:
«После изменения статуса задачи обнови файл задачи в todo/ (или попроси меня это сделать)»

### 4. Добавить git-flow рекомендации в шаблон задачи

В конец каждой задачи добавить раздел:

```markdown
## Git Workflow (рекомендуемый)
- Branch: `task/TASK-xxx-краткое-название`
- Commit message: `[TASK-xxx] Краткое описание изменения`
- PR title: `TASK-xxx: подробное название задачи`
- PR description: ссылка на .todo.md + скриншоты/результаты, если применимо
```

### 5. Методология постановки задач (Stratoplan & Best Practices)
Внедрить практики из лекций Стратоплана для повышения четкости задач для ИИ-агентов, рассматривая агента как сотрудника с определенным уровнем зрелости:

#### Алгоритм постановки задачи
Каждая задача должна содержать 5 обязательных элементов:
1.  **Цель**: Что нужно сделать? (Образ результата).
2.  **Контекст**: Почему это нужно? (Связь с другими модулями, бизнес-ценность).
3.  **Критерии успеха**: Как проверим, что задача выполнена? (Тесты, линтеры, поведение UI).
4.  **Ресурсы/Ограничения**: Документация, примеры кода, запрет на изменение определенных файлов.
5.  **Контроль**: Промежуточные точки сверки (например, "покажи план перед кодированием").

#### Ситуационное управление (Hersey-Blanchard)
Адаптировать стиль описания задачи под "уровень зрелости" агента (или сложность задачи для модели):
-   **R1 (Новичок / Сложная новая задача):** **Директивный стиль**. Четкие пошаговые инструкции, псевдокод, жесткие ограничения. "Делай 1, 2, 3".
-   **R2 (Разочаровавшийся ученик):** **Наставнический стиль**. Объяснять *почему* так надо, давать примеры, поддерживать диалог.
-   **R3 (Способный, но осторожный):** **Поддерживающий стиль**. Обрисовать проблему, спросить "Как бы ты это решил?", утвердить план.
-   **R4 (Эксперт / Типовая задача):** **Делегирующий стиль**. "Нужно реализовать X, сделай красиво по паттернам проекта".

#### Методика STAR (для описания багов и фич)
Использовать структуру STAR при постановке задач:
-   **S (Situation):** Какова ситуация/окружение? (Версия PHP, библиотека, состояние базы).
-   **T (Task):** В чем заключалась задача/проблема? (Что пытались сделать).
-   **A (Action):** Что нужно сделать/было сделано? (Шаги воспроизведения или требуемые действия).
-   **R (Result):** Ожидаемый результат (или наблюдаемый результат при баге).

#### Уровни делегирования
Явно указывать в метаданных задачи или промпте уровень делегирования:
1.  **Жди указаний:** "Предложи план и жди подтверждения".
2.  **Предлагай варианты:** "Предложи 2-3 варианта решения, я выберу".
3.  **Действуй, но докладывай:** "Реализуй, но показывай дифы перед коммитом".
4.  **Действуй автономно:** "Реализуй полностью, прогони тесты и создай PR".

### Дополнительные улучшения (следующий этап после первых результатов)

- Создать подпапки: `todo/in_progress/`, `todo/review/`
- Внедрить `.claude/commands/` или` .cursor/rules/` с быстрыми командами:
  - /refine-task
  - /decompose
  - /update-plan
- Добавить "learning loop": после каждой задачи агент отвечает на вопрос «Что полезного добавить в AGENTS.md на основе этой задачи?»
- Если используешь Cursor → попробовать .mdc-формат для правил