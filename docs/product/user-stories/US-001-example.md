# US-001: –ó–∞–≥—Ä—É–∑–∫–∞ PDF —á–µ—Ä–µ–∑ CLI –∏ –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ API

**Status:** üìã Planned

---

## Actor/Context

**Actor:** –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (Developer)

**Context:** –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ö–æ—á–µ—Ç –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å PDF-–¥–æ–∫—É–º–µ–Ω—Ç —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É.

---

## Goal

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ö–æ—á–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å PDF-—Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ CLI –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–ª–∞ –∏—Ö, –∏ –∑–∞—Ç–µ–º –º–æ–≥ –≤—ã–ø–æ–ª–Ω—è—Ç—å semantic search —á–µ—Ä–µ–∑ REST API.

---

## Value

- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ–∏—Å–∫—É –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å TasK –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å:** CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å ingest –≤ CI/CD –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–∞—Ö

---

## Story

**–ö–∞–∫** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫,
**–Ø —Ö–æ—á—É** –∑–∞–≥—Ä—É–∂–∞—Ç—å PDF-–¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ CLI –∫–æ–º–∞–Ω–¥—É,
**–ß—Ç–æ–±—ã** —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–ª–∞ –µ–≥–æ, –∏ —è –º–æ–≥ –∏—Å–∫–∞—Ç—å –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —á–µ—Ä–µ–∑ API.

---

## Acceptance Criteria

### CLI Ingestion
- [ ] –ö–æ–º–∞–Ω–¥–∞ `bin/console app:source:ingest <path>` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- [ ] –ö–æ–º–∞–Ω–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (source_id)
- [ ] –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ –æ—á–µ—Ä–µ–¥–∏
- [ ] –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è
- [ ] –ö–æ–º–∞–Ω–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

### Processing
- [ ] –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –∏–∑ PDF (–∏—Å–ø–æ–ª—å–∑—É—è pdfinfo/Docling)
- [ ] –¢–µ–∫—Å—Ç —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ chunks (intelligent chunking)
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è embeddings –¥–ª—è –∫–∞–∂–¥–æ–≥–æ chunk
- [ ] –í–µ–∫—Ç–æ—Ä–∞ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ PostgreSQL + pgvector
- [ ] Source status –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–æ "indexed"

### API Search
- [ ] API endpoint `POST /api/v1/search` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  ```json
  {
    "query": "string",
    "limit": 10,
    "offset": 0
  }
  ```
- [ ] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
  ```json
  {
    "results": [
      {
        "chunk_id": "uuid",
        "content": "string",
        "score": 0.95,
        "source": {
          "id": "uuid",
          "filename": "document.pdf"
        }
      }
    ],
    "total": 100,
    "query": "string"
  }
  ```
- [ ] API –≤—ã–ø–æ–ª–Ω—è–µ—Ç semantic search –ø–æ –∏–Ω–¥–µ–∫—Å—É (–Ω–µ keyword search)

### Error Handling
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ source —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "failed"
- [ ] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 4xx –¥–ª—è client errors –∏ 5xx –¥–ª—è server errors
- [ ] Error response —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

---

## BDD Scenarios

### Scenario 1: Successful PDF upload via CLI
**Given** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏–º–µ–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π PDF-—Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ä–æ–º < 50MB
**When** –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç `bin/console app:source:ingest /path/to/file.pdf`
**Then** –∫–æ–º–∞–Ω–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `source_id` –≤ —Ñ–æ—Ä–º–∞—Ç–µ UUID
**And** source status —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "processing"
**And** –∑–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å

### Scenario 2: PDF upload with invalid file
**Given** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Ñ–∞–π–ª—É
**When** –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç `bin/console app:source:ingest /nonexistent.pdf`
**Then** –∫–æ–º–∞–Ω–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É —Å –∫–æ–¥–æ–º 1
**And** —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å–æ–¥–µ—Ä–∂–∏—Ç "File not found"

### Scenario 3: Successful semantic search via API
**Given** PDF-–¥–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω —Å `source_id = "abc-123"`
**When** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /api/v1/search {"query": "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã", "limit": 10}`
**Then** API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 —Å –º–∞—Å—Å–∏–≤–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
**And** –∫–∞–∂–¥—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç `chunk_id`, `content`, `score`, `source`
**And** `score` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0, 1]

### Scenario 4: Search with no results
**Given** –∏–Ω–¥–µ–∫—Å –ø—É—Å—Ç (–Ω–µ—Ç –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
**When** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /api/v1/search {"query": "test", "limit": 10}`
**Then** API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 —Å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º `results`
**And** `total` = 0

### Scenario 5: Processing pipeline completes successfully
**Given** –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ —Å—Ç–∞—Ç—É—Å–µ "processing"
**When** pipeline –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É
**Then** —Ç–µ–∫—Å—Ç –∏–∑–≤–ª–µ—á—ë–Ω –∏–∑ PDF
**And** —Ç–µ–∫—Å—Ç —Ä–∞–∑–±–∏—Ç –Ω–∞ chunks (~500-1000 tokens –∫–∞–∂–¥—ã–π)
**And** embeddings —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ chunk
**And** –≤–µ–∫—Ç–æ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ PostgreSQL + pgvector
**And** source status –æ–±–Ω–æ–≤–ª—ë–Ω –¥–æ "indexed"

### Scenario 6: Processing pipeline fails
**Given** –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ —Å—Ç–∞—Ç—É—Å–µ "processing" (–ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π PDF)
**When** pipeline –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
**Then** source status –æ–±–Ω–æ–≤–ª—ë–Ω –¥–æ "failed"
**And** –æ—à–∏–±–∫–∞ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∞ —Å —É—Ä–æ–≤–Ω–µ–º ERROR
**And** `error_message` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

---

## Non-Goals

- ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (MVP ‚Äî internal use only)
- ‚ùå –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∫—Ä–æ–º–µ PDF (–±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏—Ö US)
- ‚ùå –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º (–±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏—Ö US)
- ‚ùå –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã (–±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏—Ö US)

---

## Notes/Open Questions

**Open Questions:**
- –ö–∞–∫–æ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è ingest? (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50MB)
- –°–∫–æ–ª—å–∫–æ chunks –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç? (adaptive chunking, ~500-1000 tokens)
- –ö–∞–∫–æ–π LLM –¥–ª—è embeddings? (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: Ollama —Å nomic-embed-text)

**Notes:**
- –î–ª—è MVP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π API; –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –±–µ–∑ notice
- CLI –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `worker-cli`
- API endpoint –ø–æ–∫–∞ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (MVP scope)

---

## Links

- **Related Stories:**
  - [US-002](US-002-example.md) ‚Äî Product manager creates project and team searches via web
  - US-003 ‚Äî User configures S3 bucket as source

- **Related Docs:**
  - [MVP](../mvp.md) ‚Äî MVP scope and acceptance criteria
  - [Vision](../vision.md) ‚Äî product vision
  - [Story Mapping](../story-mapping.md) ‚Äî release planning

- **Architecture:**
  - [ADR-0001](../../architecture/adr/ADR-0001-example.md) ‚Äî Vector DB selection (PostgreSQL + pgvector)
  - [ADR-0002](../../architecture/adr/ADR-0002-example.md) ‚Äî Internal-first API policy
