# Приглашения: регистрация vs присоединение к команде

В TasK остался единый механизм отправки и переотправки инвайтов. Сервис `SendTeamInvitationEmailService`
получает контекст приглашения и сам определяет, нужно ли вести человека на регистрацию или сразу в команду.

## Как это работает

* Обработчики `/invitations` и `teams/{uuid}/view` используют один и тот же сервис.
* В командных сценариях в метод `send()` передаётся `TeamInvitationEmailContext` с токеном членства и признаком,
  что пользователь уже зарегистрирован.
* Шаблон письма анализирует контекст:
  * если регистрация ещё требуется, показывается кнопка перехода на `AuthRoute::signUp()` и код приглашения;
  * если пользователь уже в системе, письмо строит ссылку `TeamMembershipRoute::inviteAccept()` для вступления в команду.

## Что видит пользователь

| Сценарий | Контент письма |
| --- | --- |
| Первичное приглашение/ресенд из `/invitations` | регистрационный код, срок действия, ссылка на регистрацию, опционально команда и имя пригласившего |
| Командный ресенд для незарегистрированного | те же данные, что и для регистрации, плюс напоминание о ссылке в команду после завершения регистрации |
| Командный ресенд для уже зарегистрированного | кнопка перехода в команду и прямой линк на `teams/invite/{token}/accept`, срок действия инвайта |

Таким образом, любой resend приводит к одному и тому же сервису и шаблону, а различия в тексте определяются только
контекстом приглашения.
