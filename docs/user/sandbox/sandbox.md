# Песочница (Sanbox)

**Песочница (Sanbox)** - это окружение (папка экземпляра проекта) для разработки или тестирования, поднятое под
конкретную задачу или серию задач.

Песочницы нужны для изолированной параллельной разработки/экспериментов с ИИ-агентами (CodexCLI, GeminiCLI, Aider,
RooCode и т.д.) без засорения основного репо и окружения. Каждая sandbox — свой контейнер, свой домен и
сеть, свой TLS; можно запускать несколько одновременно, ~~сравнивать результаты~~, быстро сносить. Git-ветки в таких
копиях создаются и настраиваются вручную внутри песочницы при необходимости.

К примеру ИИ агент [Gemini Cli](https://github.com/google-gemini/gemini-cli)  хорошо пишет тексты и делает UI.
Разработчик может поднять у себя sandbox для выполнения задач через Gemini Cli.

Рекомендуется поднимать sandbox для задач следующего типа:

- **Крупные, сложные** (эпики) - требующие глубокого понимания домена, архитектурных компромиссов, которые могут
  приводить к изменению архитектуры, внедрению новых подсистем (модулей).
- **Задачи с высоким уровнем не определенности** (спайки, R&D, PoC, прототипы, MVP) - когда неизвестно, получится ли
  вообще; когда неясно “что нужно” и мы хотим проверить гипотезу или получить прототип.

Простые, мелкие задачи лучше делать/тестировать в обычном окружении так как не будет трат времени на "возню" с
песочницей.

## Общие правила

- Имя песочницы `{SanboxName}` может быть как название инструмента которым ведется разработка (пример: `CodexCli`,
  `RooCode`), так и именем или номером задачи (пример: `task-565`, `task-Organize_Security_folder_in_modules`)

## Расположение

Структура
```
~/MyProjects
├── {ProjectName}/
│   ├── Development/
│   ├── Sandbox/
│   │   ├── {SanboxName}
│   │   ├── ...
│   └── certs/
├── ...
```


```code
{HomeDir}/MyProjects/{ProjectName}/Sandbox/{SanboxName}
```

`{HomeDir}` - домашний каталог пользователя, системы
`{ProjectName}` - общепринятое имя проекта в команде
`{SanboxName}` - имя песочницы

## Как используем

- Создаем проект-песочницу: `bin/sandbox-new task-{task_name_name} -p task --init`
- Создаем проект-песочницу: `bin/sandbox-new task-{task_name_name} -p task --init`
- Монитороинг:  http://localhost:8081/dashboard/

## Пример

```
# Основное окружение где ведется разработка
{HomeDir}/MyProjects/{ProjectName}/Development

# Основное окружение где ведется тестирование
{HomeDir}/MyProjects/{ProjectName}/Testing

# Основное окружение где ведется разработка агентами
{HomeDir}/MyProjects/{ProjectName}/Sandbox/GeminiCli
{HomeDir}/MyProjects/{ProjectName}/Sandbox/CodexCli
{HomeDir}/MyProjects/{ProjectName}/Sandbox/QwenCli
{HomeDir}/MyProjects/{ProjectName}/Sandbox/task-565
{HomeDir}/MyProjects/{ProjectName}/Sandbox/task-Organize_Security_folder_in_modules

```

## Чек лист

- [ ] {пункт списка}

## OAuth и внешние провайдеры

По умолчанию песочницы используют только аутентификацию по email/паролю. Чтобы задействовать социальные входы
(Google, Yandex, GitHub и т.д.), следуйте инструкции из [docs/user/auth/oauth/index.md](../auth/oauth/index.md): там
описано, как добавить redirect URI песочницы и прописать клиентские ключи.

## Дамп БД для песочниц

Подробное руководство по снятию дампа и восстановлению описано в [docs/user/db-dump.md](../db-dump.md). Используйте его
при подготовке копии данных для песочниц.

## Очереди и RabbitMQ

Для всех sandbox рекомендуется использовать единый RabbitMQ, описанный в руководстве по развёртыванию — см. [../devops/production/rabbitmq.md](../devops/production/rabbitmq.md). Ключевые моменты:

- каждому окружению назначайте собственный `RABBITMQ_VHOST` и пользователя, чтобы очереди и события не пересекались;
- переменные `RABBITMQ_*` песочницы переопределяются в её `.env.local` и указывают на общий брокер;
- если нужна полностью автономная sandbox, следуйте разделу «Отдельный контейнер» в [../devops/production/rabbitmq.md](../devops/production/rabbitmq.md) (там описаны команды `make up`, `devops/scripts/rabbitmq-up.sh` и настройка портов).

Таким образом, sandbox либо делит общий RabbitMQ через отдельные vhost, либо запускает собственный контейнер — подробная инструкция по обоим режимам находится в [../devops/production/rabbitmq.md](../devops/production/rabbitmq.md).
