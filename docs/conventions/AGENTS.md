# Правила для AI-агентов по работе с документацией и конвенциями (Documentation and Conventions Guidelines for AI Agents)

## Назначение

Данный документ содержит обязательные правила для AI-агентов (Codex, OpenCode, Roo, Kilo Code и др.) по работе с документацией проекта TasK, расположенной в директории `docs/conventions/`.

## Общие принципы

- **Язык**: русский (с английским термином в скобках при первом упоминании).
- **Точность**: без воды, только то, что поможет программисту применить подход правильно.
- **Структура**: каждый документ описывает один подход или одну сущность.
- **Источники**: используем ссылки на официальные источники (Wikipedia, Symfony docs, книги по DDD и Clean Code).
- **Код**: PHP 8.4 с использованием Symfony 7.3, строго типизированный.

---

## Структура директории docs/conventions/

```
docs/conventions/
├── AGENTS.md                 # Этот файл — правила для AI-агентов
├── doc-writing-rules.md      # Правила написания документации
├── layers/                   # Документация по слоям архитектуры
│   ├── domain/
│   ├── application/
│   ├── infrastructure/
│   └── integration/
├── patterns/                 # Документация по паттернам
├── naming/                   # Конвенции именования
└── ...                       # Другие категории документации
```

---

## Обязательная структура документа конвенции

Каждый документ в `docs/conventions/` должен содержать следующие разделы:

### 1. Заголовок

- На русском + в скобках английский термин.
- Пример: `# Спецификация (Specification pattern)`

### 2. Определение

- Краткое описание подхода.
- Указываем ссылку на источник, если это паттерн или термин (например, Gang of Four, DDD).

### 3. Общие правила

- Четкие, нумерованные или маркированные пункты.
- Указываем: можно/нельзя, как именовать классы, как внедрять в код.

### 4. Зависимости (если применимо)

- Что можно внедрять в класс.
- Что запрещено (например, зависимости из других слоёв).

### 5. Расположение (если применимо)

- Указываем слой (Domain, Application, Infrastructure, Integration).
- Путь в иерархии папок.
- Пример пути.

### 6. Как используем

- Правила внедрения.
- Ограничения (где допустимо, где запрещено).

### 7. Пример

- Минимальный рабочий пример на PHP (короткий и понятный).
- В примере демонстрируются правильные практики.

### 8. Чек-лист для проведения ревью кода (опционально)

- Список проверок для соответствия конвенции.

---

## Форматирование

### Markdown

- Используем **Markdown** для всех документов.

### Кодовые блоки

```php
<?php
declare(strict_types=1);
```

### Правила для примеров кода

- ❗ **Запрещено использовать псевдокод** — всегда реальный PHP-пример, взятый из текущего проекта и упрощенный.
- Комментарии в примере минимальны, код должен быть самодокументируемым.
- Все примеры должны быть рабочими и компилируемыми.

---

## Шаблон документа

````markdown
# {Заголовок на русском} ({Английское название})

**{Название подхода на русском} ({Английское название})** — {краткое определение с ссылкой}.

## Общие правила

- ...
- ...
- ...

## Зависимости

- ...
- ...

## Расположение

```
Common\Module\{ModuleName}\{Layer}\{Context}\{Name}
```

## Как используем

- ...
- ...

## Пример

```php
<?php

declare(strict_types=1);

namespace Common\Module\User\Domain\Specification;

final readonly class ExampleSpecification
{
    public function isSatisfiedBy(User $user): bool
    {
        return $user->isActive();
    }
}
```

## Чек-лист для проведения ревью кода

- [ ] {пункт списка}
- [ ] {пункт списка}
````

---

## Правила создания новых документов

### 1. Проверка существования

Перед созданием нового документа:
- Проверьте, нет ли уже документа на эту тему в `docs/conventions/`.
- Используйте `codebase_search` для поиска по ключевым словам.

### 2. Выбор категории

Определите категорию документа:
- `layers/` — если документ описывает слой архитектуры.
- `patterns/` — если документ описывает паттерн проектирования.
- `naming/` — если документ описывает конвенции именования.
- Создайте новую категорию при необходимости.

### 3. Именование файла

- Используйте lowercase с дефисами: `value-object.md`, `repository-pattern.md`.
- Имя файла должно отражать суть документа.

### 4. Обновление индекса

При создании нового документа добавьте ссылку на него в соответствующий индексный файл (если он существует).

---

## Правила обновления существующих документов

### 1. Синхронизация с кодом

- Если изменяется архитектура или конвенции в коде — обновите соответствующий документ.
- Если документ устарел — пометьте его `@deprecated` и создайте новый.

### 2. Версионирование

- Значительные изменения в конвенциях должны быть задокументированы в `CHANGELOG.md`.
- Указывайте дату последнего обновления в документе (опционально).

### 3. Проверка ссылок

- Проверьте, что все ссылки в документе актуальны.
- Обновите ссылки на другие документы при их переименовании.

---

## Правила для AI-агентов

### При создании документации

1. **Изучите существующие документы** в `docs/conventions/` перед созданием нового.
2. **Следуйте обязательной структуре** документа.
3. **Используйте реальные примеры** из проекта, не псевдокод.
4. **Добавляйте ссылки** на официальные источники.
5. **Пишите на русском** с английскими терминами в скобках.

### При обновлении кода

1. **Проверьте наличие конвенции** для изменяемого кода.
2. **Следуйте конвенциям** из `docs/conventions/`.
3. **Обновите документацию**, если изменения затрагивают конвенции.
4. **Добавьте @todo** в код, если конвенция не соблюдена временно.

### При ревью кода

1. **Проверяйте соответствие** конвенциям из `docs/conventions/`.
2. **Используйте чек-листы** из документов.
3. **Требуйте обновления** документации при изменении конвенций.

---

## Примеры категорий документов

### Слои архитектуры (layers/)

- `layers/domain/entity.md` — Сущность (Entity)
- `guides/value-object.md` — Объект-значение (Value Object)
- `layers/domain/repository-interface.md` — Интерфейс репозитория
- `layers/application/use-case.md` — Use Case
- `layers/infrastructure/repository.md` — Репозиторий

### Паттерны (patterns/)

- `patterns/specification.md` — Спецификация (Specification pattern)
- `patterns/strategy.md` — Стратегия (Strategy pattern)
- `patterns/factory.md` — Фабрика (Factory pattern)

### Именование (naming/)

- `naming/classes.md` — Именование классов
- `naming/methods.md` — Именование методов
- `naming/variables.md` — Именование переменных

---

## Интеграция с AGENTS.md

Данный документ дополняет корневой файл `AGENTS.md` в корне проекта. При конфликте правил:
- Приоритет имеет корневой `AGENTS.md`.
- Этот документ (`docs/conventions/AGENTS.md`) специализируется на работе с документацией в `docs/conventions/`.

---

## Чек-лист для AI-агента перед созданием/обновлением документа

- [ ] Изучены существующие документы в `docs/conventions/`
- [ ] Проверено отсутствие дублирования
- [ ] Выбрана правильная категория
- [ ] Соблюдена обязательная структура документа
- [ ] Использованы реальные примеры кода из проекта
- [ ] Добавлены ссылки на официальные источники
- [ ] Проверены все ссылки в документе
- [ ] Обновлен индекс (если применимо)
- [ ] Документ написан на русском с английскими терминами
