# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ yt-dlp

`yt-dlp` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ, —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ YouTube –∏ RuTube. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç Symfony
(`YtDlpComponent`) –æ–∂–∏–¥–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `/opt/yt-dlp`. –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
–∏
–æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–∞ production-—Å–µ—Ä–≤–µ—Ä–µ.

## –ß–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –æ—Ç root –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å sudo.

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python
mkdir -p /opt/yt-dlp
python3 -m venv /opt/yt-dlp

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ yt-dlp
/opt/yt-dlp/bin/pip install --upgrade pip
/opt/yt-dlp/bin/pip install --no-cache-dir yt-dlp

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
ln -sf /opt/yt-dlp/bin/yt-dlp /usr/local/bin/yt-dlp
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é:

```bash
/usr/local/bin/yt-dlp --version
```

## –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- **–ö–∞—Ç–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** `/opt/yt-dlp` (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python)
- **–ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª:** `/usr/local/bin/yt-dlp` (—Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞)
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env.local` –∏–ª–∏ Secrets –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

  ```dotenv
  YT_DLP_BIN_PATH="/usr/local/bin"
  YT_DLP_PROXY="socks5://user:password@host:port"
  ```

  –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —è–≤–Ω–æ –∑–∞–¥–∞–π—Ç–µ `YT_DLP_PROXY=""`, —á—Ç–æ–±—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–ª —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** –≤–ª–∞–¥–µ–ª–µ—Ü `wwwtask:wwwtask`, –ø—Ä–∞–≤–∞ `0755`, —á—Ç–æ–±—ã `proc_open()` –º–æ–≥ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–∑ PHP.

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:

```bash
YT_DLP_YOUTUBE_ADDITIONAL_ARGUMENTS="-f bestaudio/best --limit-rate 500K --sleep-interval 5 --max-sleep-interval 10 --sleep-subtitles 30"
YT_DLP_RUTUBE_ADDITIONAL_ARGUMENTS="-f b[height<=480] --limit-rate 500K --hls-use-mpegts --sleep-interval 2 --max-sleep-interval 5"
```

–≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è—é—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–∂–∏–¥–∞–Ω–∏—è, —É–º–µ–Ω—å—à–∞—è —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö
—Å–∫–∞—á–∏–≤–∞–Ω–∏—è—Ö.

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ —Å–≤–µ–∂–µ–π –≤–µ—Ä—Å–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± (—á–µ—Ä–µ–∑ pip)

```bash
/opt/yt-dlp/bin/pip install --upgrade yt-dlp
```

- –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
  ```bash
  /opt/yt-dlp/bin/pip install yt-dlp==2023.12.30
  ```

- –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ nightly-–≤–µ—Ä—Å–∏–∏:
  ```bash
  /opt/yt-dlp/bin/pip install --upgrade --pre yt-dlp
  ```

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é:

```bash
/usr/local/bin/yt-dlp --version
```

–ü–æ—Å–ª–µ –ª—é–±–æ–π –∏–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–µ–∂–µ—Å—Ç—å –ª–æ–≥–æ–≤:

```bash
sudo tail -n 50 /var/www/task/var/log/yt_dlp.log
```

## üß™ Smoke-—Ç–µ—Å—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

```bash
/usr/local/bin/yt-dlp \
  -o "/tmp/test-%(id)s.%(ext)s" \
  -f bestaudio "https://youtu.be/dQw4w9WgXcQ"
```

- –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ `/tmp`.
- –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É–¥–∞–ª–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `rm -f /tmp/test-*`.

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

| –°–∏–º–ø—Ç–æ–º             | –ü—Ä–∏—á–∏–Ω–∞                                                                   | –†–µ—à–µ–Ω–∏–µ                                                                                                                         |
|---------------------|---------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| `command not found` | –ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `YT_DLP_BIN_PATH` –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞. | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env.local` / Secrets –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `/usr/local/bin/yt-dlp` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.                                           |
| `Permission denied` | –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.                                                   | `sudo chmod +x /usr/local/bin/yt-dlp`                                                                                           |
| –û—à–∏–±–∫–∏ TLS/SSL      | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã.                                 | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç `ca-certificates` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `sudo update-ca-trust` (AlmaLinux/RHEL). |

–£—Ç–∏–ª–∏—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python –≤ `/opt/yt-dlp` –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É
`/usr/local/bin/yt-dlp`. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ pip.
