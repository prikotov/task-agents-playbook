# Шаблон постановки задачи LLM (v4)

Этот шаблон предназначен для постановки задач AI‑агентам, таким как Codex, в рамках проекта **TasK**. Заполните каждый
раздел, чтобы обеспечить модель необходимым контекстом, критериями и ограничениями. При формулировке задач
ориентируйтесь на правила проекта и профиль агента.

## 1. Контекст и цель

- **Что и почему:** кратко опишите бизнес‑проблему или пользовательскую потребность, которую решает функция/исправление.
- **Модуль и слой:** укажите, в каком модуле (`src/Module/{ModuleName}`) и слое (Domain, Application, Infrastructure,
  Integration) будет реализована задача.
- **Окружение:** версии языка и фреймворков (PHP 8.3, Symfony 7.3, Bootstrap 5 Phoenix), а также целевые браузеры или
  платформы.

## 2. Образ результата

- **Формат:** что нужно получить на выходе — файл(ы), класс, функция, компонент UI, тесты, документация.
- **Слой/архитектура:** отразите, где должен располагаться код (Domain, Application, Infrastructure). Соблюдайте
  модульную изоляцию.
- **Вывод/формат:** в каком виде должна быть представлена работа (кодовые блоки в markdown, архив, pull request и т.д.).
- **Уровень строгости:**
    - `skeleton` — сгенерировать каркас с основными классами/методами без реализации деталей;
    - `full` — полная рабочая реализация с тестами;
    - `with explanations` — реализация, сопровождаемая комментариями и пояснениями.

## 3. Ресурсы и входные данные

- **Исходный код:** фрагменты текущей реализации, конфиги, пути к нужным классам. Это уменьшает неоднозначность и
  помогает модели использовать существующие примеры.
- **Документация и ссылки:** ссылки на `AGENTS.md`, `docs/conventions`, задачи или issues, примеры аналогичной
  функциональности.
- **Данные/сценарии:** тестовые данные, шаги воспроизведения бага или описание UX‑сценария.
- **Версии и зависимости:** допустимые/запрещённые библиотеки, ограничения по обновлению пакетов.

## 4. Критерии успеха

- **Тесты:** перечислите юнит‑тесты и/или интеграционные тесты, которые должны пройти. Укажите минимальный уровень
  покрытия (≥80 %).
- **CI/CD:** задачи должны успешно проходить `make psalm`, `make phpcs`, `make tests-unit`, `make deptrac` и
  `make audit`. При необходимости — `make check`.
- **Дополнительные метрики:** максимальное время выполнения, ограничение по памяти, соответствие стандартам кодирования
  и форматирования.
- **Приёмка:** кто принимает задачу (имя/роль) и какие критерии используются для оценки качества.

## 5. Шаги выполнения

- Разбейте задачу на этапы (план) — например:
    1. Проанализировать существующий код и определить место расширения;
    2. Согласовать API/DTO и изменить схему базы данных;
    3. Реализовать бизнес‑логику, контроллеры и формы;
    4. Написать и запустить юнит‑/интеграционные тесты;
    5. Обновить документацию и комментарии;
    6. Подготовить PR.
- Для новичков список шагов может быть детализирован, для опытных — с общими ориентирами. Зафиксируйте, когда нужно
  показывать промежуточный результат.

## 6. Точки контроля

- Укажите, после какого шага необходимо предоставить промежуточный результат (например, после формирования плана или
  после создания API).
- Определите формат обратной связи: письменная (комментарии), устная (созвон), код‑ревью.

## 7. Проверка понимания

- Попросите модель пересказать задачу или выдать план в собственных словах. Это поможет убедиться, что задача понята
  правильно.
- В зависимости от сложности задачи может потребоваться несколько раундов уточнений.

## 8. Режим генерации и стиль кода

- **Стиль:** укажите, требуется ли использовать PHPDoc, type‑hinting, следовать PSR‑12, PEP‑8 (для Python) или иные
  стандарты.
- **Комментарии:** нужны ли inline комментарии, docstrings и пояснения.
- **Форматирование:** придерживаться стандартов (например, `phpcs.xml.dist`), избегать генерации произвольного HTML/JS,
  если не требуется.

## 9. Коммиты, документация и PR

- **Тип коммита:** определите префикс (`feat`, `fix`, `docs`, `refactor`, `test` и т. д.) на основе сущности
  задачи.
- **Ветка:** укажите имя ветки в формате `task/<slug>`, где `<slug>` отражает суть задачи (например,
  `task/add-tag-system`).
- **Conventional Commits:** все сообщения коммитов должны соответствовать Conventional Commits и генерироваться через
  скрипт `vendor/bin/conventional-commits prepare`.
- **Пулреквест:** напоминайте, что один PR должен содержать только одно логически завершённое изменение, не смешивая
  разные типы изменений. В описании PR нужно указать цель, изменённые модули, результаты
  тестов и ссылки на задачи.
- **Документация:** отметить, что новые API или изменения контрактов требуют обновления
  документации; временные решения — помечать `@todo`/`@techdebt`.

## 10. Пример заполнения

```
### 1. Контекст и цель
Пользователи хотят быстро классифицировать проекты и чаты. Нужно реализовать систему тегов. Модуль: Tag. Слой: Application + Infrastructure. Окружение: PHP 8.3, Symfony 7.3, Bootstrap 5 Phoenix.

### 2. Образ результата
- Миграция для таблицы `tag` и связующей таблицы `project_tag` и `chat_tag`.
- Классы: `Tag` (Entity), `TagRepository`, UseCase `CreateTag`, `ListTags`, `DeleteTag`.
- Контроллеры для CRUD, шаблоны UI с использованием SymfonyUX.
- Тесты: unit и integration; покрытие ≥80%.
- Вывод: PR с рабочей фичей.
- Уровень строгости: full.

### 3. Ресурсы и входные данные
- Существующие примеры CRUD (см. `src/Module/User`).
- Ссылка на AGENTS.md и conventions.
- Никаких сторонних библиотек.

### 4. Критерии успеха
- `make psalm`, `make phpcs`, `make tests-unit`, `make deptrac`, `make audit` — без ошибок.
- Unit/integration tests проходят, покрытие ≥80%.
- Сообщения коммитов соответствуют ConventionalCommits.

### 5. Шаги выполнения
1. Создать план, обсудить его.
2. Добавить сущность и миграцию.
3. Реализовать UseCase и репозиторий.
4. Создать контроллеры и формы.
5. Написать тесты.
6. Запустить проверки (`make psalm`, …).
7. Создать PR.

### 6. Точки контроля
- После составления плана.
- После реализации UseCase и тестов.

### 7. Проверка понимания
- Перескажи задачу, перечисли шаги.

### 8. Режим генерации и стиль кода
- Использовать PHP8.3 с типами, PHPDoc, соответствие PSR‑12.
- Комментарии только для сложных мест.

### 9. Коммиты, документация и PR
- Тип: feat.
- Ветка: task/implement-tag-system.
- Обновить модульную документацию, пометить временные решения `@todo`.
```
